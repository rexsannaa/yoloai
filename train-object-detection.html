<!-- train-object-detection.html - 物件偵測訓練頁面 -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>物件偵測訓練 - 南臺科技大學AI視覺訓練平台</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="css/core.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/training.css">
</head>
<body>
  <!-- 側邊欄 -->
  <div class="sidebar" id="main-sidebar">
    <div class="sidebar-header">南臺科技大學AI視覺訓練平台</div>
    <ul class="sidebar-menu">
      <li data-view="workspace"><span><i class="fas fa-user-friends"></i> 1120</span><span>&gt;</span></li>
      <li data-view="public-projects"><span>公共計畫</span><span>&gt;</span></li>
      <li id="projects-link" data-view="projects"><span><i class="fas fa-project-diagram"></i> 專案</span></li>
      <li id="workflows-link" data-view="workflows"><span><i class="fas fa-cogs"></i> AI訓練</span></li>
      <li data-view="model-zoo"><span><i class="fas fa-brain"></i> 模型庫</span></li>
      <li data-view="deployment"><span><i class="fas fa-rocket"></i> 部署</span></li>
      <li data-view="monitoring"><span><i class="fas fa-chart-line"></i> 監控</span></li>
      <li id="settings-toggle" data-popup="settings-popup"><span><i class="fas fa-cog"></i> 設定</span><span>&gt;</span></li>
    </ul>
    <div class="sidebar-footer">
      <div class="user-info" data-popup="account-menu">
        <div class="user-avatar" id="user-avatar">測</div>
        <div>
          <div id="user-name"><strong>測試帳戶</strong></div>
          <div id="user-email">test@demo.com</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 主內容 -->
  <main class="main-content">
    <!-- 訓練進度條 -->
    <div class="training-progress-bar">
      <div class="progress-steps">
        <div class="progress-step active" data-step="1">
          <div class="step-number">1</div>
          <div class="step-label">資料準備</div>
        </div>
        <div class="progress-step" data-step="2">
          <div class="step-number">2</div>
          <div class="step-label">資料標註</div>
        </div>
        <div class="progress-step" data-step="3">
          <div class="step-number">3</div>
          <div class="step-label">模型訓練</div>
        </div>
        <div class="progress-step" data-step="4">
          <div class="step-number">4</div>
          <div class="step-label">測試部署</div>
        </div>
      </div>
      <div class="progress-line">
        <div class="progress-fill" style="width: 25%"></div>
      </div>
    </div>

    <!-- 訓練內容區域 -->
    <div class="training-container animated fadeSlideUp">
      
      <!-- Step 1: 資料準備 -->
      <div class="training-step active" id="step-1">
        <div class="step-header">
          <h2><i class="fas fa-images"></i> 資料準備</h2>
          <p>上傳用於訓練物件偵測模型的圖片資料</p>
        </div>

        <div class="training-content">
          <div class="upload-section">
            <div class="upload-area" id="upload-area">
              <div class="upload-placeholder">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>拖拽圖片到此處或點擊上傳</h3>
                <p>支援 JPG, PNG, WEBP 格式，建議至少 20 張圖片</p>
                <p>單張圖片大小不超過 10MB</p>
                <input type="file" id="file-input" multiple accept="image/*" style="display: none;">
                <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                  <i class="fas fa-folder-open"></i> 選擇圖片
                </button>
              </div>
            </div>

            <!-- 圖片預覽網格 -->
            <div class="image-grid" id="image-grid" style="display: none;">
              <div class="grid-header">
                <h3>已上傳圖片 (<span id="image-count">0</span>)</h3>
                <div class="grid-actions">
                  <button class="btn btn-outline btn-sm" onclick="clearAllImages()">
                    <i class="fas fa-trash"></i> 清空
                  </button>
                  <button class="btn btn-outline btn-sm" onclick="document.getElementById('file-input').click()">
                    <i class="fas fa-plus"></i> 添加更多
                  </button>
                </div>
              </div>
              <div class="images-container" id="images-container">
                <!-- 動態生成圖片縮略圖 -->
              </div>
            </div>
          </div>

          <!-- 資料集資訊 -->
          <div class="dataset-info">
            <div class="info-card">
              <div class="info-header">
                <h4><i class="fas fa-info-circle"></i> 資料集建議</h4>
              </div>
              <div class="info-content">
                <div class="suggestion-item">
                  <i class="fas fa-check-circle text-success"></i>
                  <span>每個物件類別至少 20-50 張圖片</span>
                </div>
                <div class="suggestion-item">
                  <i class="fas fa-check-circle text-success"></i>
                  <span>圖片包含不同角度、光線、背景</span>
                </div>
                <div class="suggestion-item">
                  <i class="fas fa-check-circle text-success"></i>
                  <span>圖片清晰度良好，目標物件清楚可見</span>
                </div>
                <div class="suggestion-item">
                  <i class="fas fa-exclamation-triangle text-warning"></i>
                  <span>避免過度相似的圖片</span>
                </div>
              </div>
            </div>

            <div class="info-card">
              <div class="info-header">
                <h4><i class="fas fa-chart-bar"></i> 資料統計</h4>
              </div>
              <div class="info-content">
                <div class="stat-grid">
                  <div class="stat-item">
                    <div class="stat-value" id="total-images">0</div>
                    <div class="stat-label">總圖片數</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value" id="total-size">0 MB</div>
                    <div class="stat-label">總大小</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value" id="avg-resolution">-</div>
                    <div class="stat-label">平均解析度</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value" id="ready-status">未就緒</div>
                    <div class="stat-label">狀態</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-outline" onclick="goBack()">
            <i class="fas fa-arrow-left"></i> 返回
          </button>
          <button class="btn btn-primary" id="next-to-annotation" onclick="nextStep()" disabled>
            下一步：開始標註 <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 2: 資料標註 -->
      <div class="training-step" id="step-2" style="display: none;">
        <div class="step-header">
          <h2><i class="fas fa-tags"></i> 資料標註</h2>
          <p>為圖片中的物件添加邊界框和類別標籤</p>
        </div>

        <div class="training-content">
          <div class="annotation-workspace">
            <div class="annotation-toolbar">
              <div class="toolbar-section">
                <label for="class-input">物件類別：</label>
                <input type="text" id="class-input" placeholder="輸入物件名稱 (例如：人、車、貓)" 
                       onkeypress="handleClassInput(event)">
                <button class="btn btn-sm btn-primary" onclick="addClass()">
                  <i class="fas fa-plus"></i> 添加
                </button>
              </div>
              <div class="toolbar-section">
                <div class="class-list" id="class-list">
                  <!-- 動態生成類別標籤 -->
                </div>
              </div>
            </div>

            <div class="annotation-main">
              <div class="annotation-canvas-container">
                <div class="canvas-toolbar">
                  <div class="canvas-controls">
                    <button class="btn btn-sm" id="zoom-in" onclick="zoomCanvas(1.2)">
                      <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="btn btn-sm" id="zoom-out" onclick="zoomCanvas(0.8)">
                      <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="btn btn-sm" id="fit-canvas" onclick="fitCanvas()">
                      <i class="fas fa-expand-arrows-alt"></i>
                    </button>
                  </div>
                  <div class="canvas-info">
                    <span id="current-image-info">請選擇要標註的圖片</span>
                  </div>
                  <div class="canvas-actions">
                    <button class="btn btn-sm btn-warning" onclick="clearCurrentAnnotations()">
                      <i class="fas fa-trash"></i> 清除標註
                    </button>
                    <button class="btn btn-sm btn-success" onclick="autoAnnotate()" disabled>
                      <i class="fas fa-magic"></i> AI 輔助標註
                    </button>
                  </div>
                </div>
                
                <div class="canvas-area">
                  <canvas id="annotation-canvas"></canvas>
                  <div class="canvas-overlay" id="canvas-overlay">
                    <div class="overlay-message">
                      <i class="fas fa-mouse-pointer"></i>
                      <p>點擊左側圖片開始標註</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="annotation-sidebar">
                <div class="image-list-header">
                  <h4>圖片列表</h4>
                  <div class="annotation-progress">
                    <span id="annotation-progress">0 / 0 已標註</span>
                  </div>
                </div>
                <div class="image-list" id="annotation-image-list">
                  <!-- 動態生成圖片列表 -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-outline" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> 上一步
          </button>
          <button class="btn btn-primary" id="next-to-training" onclick="nextStep()" disabled>
            下一步：開始訓練 <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 3: 模型訓練 -->
      <div class="training-step" id="step-3" style="display: none;">
        <div class="step-header">
          <h2><i class="fas fa-brain"></i> 模型訓練</h2>
          <p>配置訓練參數並開始訓練您的物件偵測模型</p>
        </div>

        <div class="training-content">
          <div class="training-config">
            <div class="config-section">
              <h4><i class="fas fa-cog"></i> 訓練配置</h4>
              <div class="config-grid">
                <div class="config-item">
                  <label for="model-size">模型大小</label>
                  <select id="model-size" onchange="updateTrainingEstimate()">
                    <option value="nano">Nano (最快)</option>
                    <option value="small" selected>Small (平衡)</option>
                    <option value="medium">Medium (精確)</option>
                    <option value="large">Large (最精確)</option>
                  </select>
                </div>
                <div class="config-item">
                  <label for="epochs">訓練輪數</label>
                  <input type="number" id="epochs" value="100" min="10" max="300" onchange="updateTrainingEstimate()">
                </div>
                <div class="config-item">
                  <label for="batch-size">批次大小</label>
                  <select id="batch-size" onchange="updateTrainingEstimate()">
                    <option value="8">8 (省記憶體)</option>
                    <option value="16" selected>16 (推薦)</option>
                    <option value="32">32 (需更多記憶體)</option>
                  </select>
                </div>
                <div class="config-item">
                  <label for="learning-rate">學習率</label>
                  <select id="learning-rate">
                    <option value="0.001">0.001 (保守)</option>
                    <option value="0.01" selected>0.01 (推薦)</option>
                    <option value="0.1">0.1 (激進)</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="config-section">
              <h4><i class="fas fa-chart-line"></i> 訓練預估</h4>
              <div class="estimate-grid">
                <div class="estimate-item">
                  <div class="estimate-value" id="estimated-time">15 分鐘</div>
                  <div class="estimate-label">預計時間</div>
                </div>
                <div class="estimate-item">
                  <div class="estimate-value" id="gpu-usage">1 GPU</div>
                  <div class="estimate-label">GPU 需求</div>
                </div>
                <div class="estimate-item">
                  <div class="estimate-value" id="model-size-mb">12 MB</div>
                  <div class="estimate-label">模型大小</div>
                </div>
                <div class="estimate-item">
                  <div class="estimate-value" id="accuracy-estimate">85-90%</div>
                  <div class="estimate-label">預期準確率</div>
                </div>
              </div>
            </div>

            <div class="config-section">
              <h4><i class="fas fa-database"></i> 資料集摘要</h4>
              <div class="dataset-summary">
                <div class="summary-item">
                  <i class="fas fa-images"></i>
                  <span>總圖片數：<strong id="summary-images">0</strong></span>
                </div>
                <div class="summary-item">
                  <i class="fas fa-tags"></i>
                  <span>標註物件：<strong id="summary-objects">0</strong></span>
                </div>
                <div class="summary-item">
                  <i class="fas fa-layer-group"></i>
                  <span>物件類別：<strong id="summary-classes">0</strong></span>
                </div>
              </div>
            </div>
          </div>

          <!-- 訓練狀態區域 -->
          <div class="training-status" id="training-status" style="display: none;">
            <div class="status-header">
              <h4><i class="fas fa-spinner fa-pulse"></i> 訓練進行中</h4>
              <div class="training-time">
                開始時間：<span id="training-start-time">--:--</span>
              </div>
            </div>
            
            <div class="training-metrics">
              <div class="metric-card">
                <div class="metric-title">訓練進度</div>
                <div class="metric-value">
                  <div class="progress-ring">
                    <div class="progress-value" id="training-progress-percent">0%</div>
                  </div>
                  <div class="progress-detail">
                    <span id="current-epoch">0</span> / <span id="total-epochs">100</span> 輪
                  </div>
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-title">損失函數</div>
                <div class="metric-chart">
                  <canvas id="loss-chart" width="200" height="100"></canvas>
                </div>
                <div class="metric-current">
                  當前損失: <span id="current-loss">--</span>
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-title">準確率</div>
                <div class="metric-chart">
                  <canvas id="accuracy-chart" width="200" height="100"></canvas>
                </div>
                <div class="metric-current">
                  當前準確率: <span id="current-accuracy">--%</span>
                </div>
              </div>
            </div>

            <div class="training-logs">
              <div class="logs-header">
                <h5>訓練日誌</h5>
                <button class="btn btn-sm btn-outline" onclick="clearLogs()">清除</button>
              </div>
              <div class="logs-content" id="training-logs">
                <!-- 動態生成訓練日誌 -->
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-outline" onclick="prevStep()" id="prev-from-training">
            <i class="fas fa-arrow-left"></i> 上一步
          </button>
          <button class="btn btn-primary" id="start-training" onclick="startTraining()">
            <i class="fas fa-play"></i> 開始訓練
          </button>
          <button class="btn btn-warning" id="pause-training" onclick="pauseTraining()" style="display: none;">
            <i class="fas fa-pause"></i> 暫停訓練
          </button>
          <button class="btn btn-danger" id="stop-training" onclick="stopTraining()" style="display: none;">
            <i class="fas fa-stop"></i> 停止訓練
          </button>
          <button class="btn btn-primary" id="next-to-testing" onclick="nextStep()" style="display: none;" disabled>
            下一步：測試模型 <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 4: 測試部署 -->
      <div class="training-step" id="step-4" style="display: none;">
        <div class="step-header">
          <h2><i class="fas fa-flask"></i> 模型測試與部署</h2>
          <p>測試訓練完成的模型並準備部署</p>
        </div>

        <div class="training-content">
          <div class="testing-section">
            <div class="model-info">
              <h4><i class="fas fa-info-circle"></i> 模型資訊</h4>
              <div class="model-stats">
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-bullseye"></i>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="final-accuracy">92.5%</div>
                    <div class="stat-label">最終準確率</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-tachometer-alt"></i>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="inference-speed">25ms</div>
                    <div class="stat-label">推理速度</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-hdd"></i>
                  </div>
                  <div class="stat-info">
                    <div class="stat-value" id="model-size-final">12.3MB</div>
                    <div class="stat-label">模型大小</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="testing-area">
              <h4><i class="fas fa-camera"></i> 即時測試</h4>
              <div class="test-options">
                <button class="btn btn-primary" onclick="testWithCamera()">
                  <i class="fas fa-video"></i> 攝影機測試
                </button>
                <button class="btn btn-outline" onclick="testWithImage()">
                  <i class="fas fa-image"></i> 圖片測試
                </button>
                <button class="btn btn-outline show-coming-soon">
                  <i class="fas fa-folder"></i> 批次測試
                </button>
              </div>
              
              <div class="test-result" id="test-result">
                <div class="result-placeholder">
                  <i class="fas fa-play-circle"></i>
                  <p>點擊上方按鈕開始測試您的模型</p>
                </div>
              </div>
            </div>

            <div class="deployment-options">
              <h4><i class="fas fa-rocket"></i> 部署選項</h4>
              <div class="deploy-grid">
                <div class="deploy-card">
                  <div class="deploy-icon">
                    <i class="fas fa-cloud"></i>
                  </div>
                  <div class="deploy-info">
                    <h5>雲端 API</h5>
                    <p>生成 REST API 接口，支援高並發調用</p>
                  </div>
                  <button class="btn btn-sm btn-primary show-coming-soon">部署</button>
                </div>
                <div class="deploy-card">
                  <div class="deploy-icon">
                    <i class="fas fa-mobile-alt"></i>
                  </div>
                  <div class="deploy-info">
                    <h5>移動設備</h5>
                    <p>導出為 TensorFlow Lite 格式</p>
                  </div>
                  <button class="btn btn-sm btn-primary show-coming-soon">導出</button>
                </div>
                <div class="deploy-card">
                  <div class="deploy-icon">
                    <i class="fas fa-microchip"></i>
                  </div>
                  <div class="deploy-info">
                    <h5>邊緣設備</h5>
                    <p>優化為 ONNX 格式用於邊緣推理</p>
                  </div>
                  <button class="btn btn-sm btn-primary show-coming-soon">優化</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-outline" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> 上一步
          </button>
          <button class="btn btn-success" onclick="completeTraining()">
            <i class="fas fa-check"></i> 完成訓練
          </button>
          <button class="btn btn-primary" onclick="saveProject()">
            <i class="fas fa-save"></i> 儲存專案
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- 彈出窗口 -->
  <div id="account-menu" class="popup-menu">
    <div><strong id="menu-username">測試帳戶</strong></div>
    <div id="menu-email">test@demo.com</div>
    <hr>
    <div class="show-coming-soon">⚙ 我的帳戶</div>
    <div class="show-coming-soon">🗂 工作區管理</div>
    <div class="show-coming-soon">💳 訂閱方案</div>
    <div class="show-coming-soon">📊 使用紀錄</div>
    <div onclick="logout()">⇦ 登出</div>
  </div>

  <div id="settings-popup" class="popup-menu">
    <div class="popup-title">工作區設定</div>
    <div class="show-coming-soon">🧾 訂閱方案與帳單</div>
    <div class="show-coming-soon">💰 GPU 使用情況</div>
    <div class="show-coming-soon">👥 使用者管理</div>
    <div class="show-coming-soon">🔑 API 金鑰</div>
  </div>

  <!-- 測試攝影機彈窗 -->
  <div id="camera-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-video"></i> 攝影機即時測試</h3>
        <button class="modal-close" onclick="closeCameraModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="camera-container">
          <video id="camera-video" autoplay muted></video>
          <canvas id="detection-canvas"></canvas>
        </div>
        <div class="detection-info">
          <div class="detection-stats">
            <div class="stat-item">
              <span class="stat-label">FPS:</span>
              <span class="stat-value" id="fps-counter">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">偵測到物件:</span>
              <span class="stat-value" id="object-count">0</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeCameraModal()">關閉</button>
        <button class="btn btn-primary" onclick="captureDetection()">
          <i class="fas fa-camera"></i> 擷取畫面
        </button>
      </div>
    </div>
  </div>

  <!-- 核心腳本 -->
  <script src="js/core.js"></script>
  <script src="js/training.js"></script>
</body>
</html>